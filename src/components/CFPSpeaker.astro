---
import { SiFacebook, SiInstagram, SiThreads, SiX, SiYoutube } from "@icons-pack/react-simple-icons";
import { Image } from "astro:assets";
import { Globe, Linkedin } from "lucide-react";
import type { Speaker } from "../@types/speakers";

interface Props {
  data: Speaker;
}

const { data }: Props = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>("../data/images/speakers/*.{png,jpg,jpeg,svg,webp}", {
  eager: true,
});
const image = Object.values(images).find((img) => img.default.src.includes(data.imageName));

// Use default image if speaker image doesn't exist
const defaultImage = Object.values(images).find((img) => img.default.src.includes("default"));
const displayImage = image || defaultImage;

if (!displayImage) {
  throw new Error(`No image found for speaker "${data.name}"`);
}
---

<div
  class="group flex h-full flex-col overflow-hidden rounded-2xl border border-white/10 bg-[#04060F] bg-gradient-to-br from-[#04060F]/95 via-[#070C1A]/95 to-[#0A1230]/90 backdrop-blur-sm transition-all duration-300 hover:border-white/20 hover:shadow-lg hover:shadow-blue-500/10">
  <!-- Speaker Image Section -->
  <div class="flex min-w-60 flex-col p-6">
    <div class="flex flex-1 flex-col">
      <div
        class="mb-4 h-32 w-32 self-center overflow-hidden rounded-2xl transition-transform duration-300 group-hover:scale-105">
        <Image
          src={displayImage.default}
          alt={data.name}
          class:list={[
            "h-full w-full object-cover grayscale transition-all duration-300 group-hover:scale-110 group-hover:grayscale-0",
          ]}
        />
      </div>

      <div class="flex flex-1 flex-col items-center text-center">
        <h3 class="mb-2 text-xl font-bold text-white">{data.name}</h3>
        <p class="mb-4 text-base text-white/80">{data.title}</p>

        <!-- Bio Section -->
        {
          data.bio && (
            <div class="mb-4 flex-1 px-2">
              <p class="line-clamp-5 text-center text-sm leading-relaxed text-white/70">{data.bio}</p>
            </div>
          )
        }

        <!-- Social Links -->
        {
          data.socialUrl.length > 0 && (
            <div class="social-links">
              <ul class="flex gap-3">
                {data.socialUrl.map((url) => (
                  <li>
                    <a
                      href={url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="flex h-10 w-10 items-center justify-center rounded-lg bg-white/10 text-white transition-colors hover:bg-white/20 hover:text-blue-400"
                      title={url}>
                      {url.includes("x.com") || url.includes("twitter.com") ? (
                        <SiX className="h-4 w-4" client:load />
                      ) : url.includes("facebook.com") ? (
                        <SiFacebook className="h-4 w-4" client:load />
                      ) : url.includes("linkedin.com") ? (
                        <Linkedin className="h-4 w-4" client:load />
                      ) : url.includes("instagram.com") ? (
                        <SiInstagram className="h-4 w-4" client:load />
                      ) : url.includes("threads.net") ? (
                        <SiThreads className="h-4 w-4" client:load />
                      ) : url.includes("youtube.com") ? (
                        <SiYoutube className="h-4 w-4" client:load />
                      ) : (
                        <Globe className="h-4 w-4" client:load />
                      )}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )
        }
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-5 {
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-6 {
    display: -webkit-box;
    -webkit-line-clamp: 6;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
